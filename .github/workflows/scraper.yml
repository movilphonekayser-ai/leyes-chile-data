name: Scraper Diario Parlamento

on:
  schedule:
    - cron: "0 10 * * *"   # Corre todos los días a las 07:00 en Chile (UTC-3)
  workflow_dispatch:        # Permite ejecutarlo manualmente

jobs:
  scrape:
    runs-on: ubuntu-latest

    steps:
      - name: Clonar repositorio
        uses: actions/checkout@v3

      - name: Configurar Node
        uses: actions/setup-node@v3
        with:
          node-version: "18"

      - name: Instalar dependencias
        run: npm install

      - name: Ejecutar scraper
        run: |
          node -e "import('./scripts/scraper.js').then(async m => {
            const fs = await import('fs');
            const data = await m.scrapeLaws();
            fs.writeFileSync('data/laws.json', JSON.stringify(data, null, 2));
          })"

      - name: Commit & push cambios
        run: |
          git config user.name 'GitHub Action'
          git config user.email 'actions@github.com'
          git add data/laws.json
          git commit -m 'Scraper: actualización automática diaria' || echo "Sin cambios para commitear"
          git push
